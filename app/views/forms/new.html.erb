<div class='form_block well'>
  <div class='form_field_catcher'>
     
  </div>
</div>
  
<div class='form_block selectables'>
  <% if @form_elements %>
    <% @form_elements.each do |element| %>
    <div class='column'>
      <div class='field_type'><%= label_tag element.label, nil, class: element.size %><br>
      <%= text_field_tag nil, nil, placeholder: element.label.gsub('_',' ').capitalize, class: element.size %>
      <%= hidden_field_tag 'fields[][element_id]', element.id %>
      <%= hidden_field_tag 'fields[][name', element.label %></div></div>
    <% end %>
  <% end %>
</div>

<script>

  $('.field_type').draggable({
    revert: 'invalid',
    helper: 'clone',
    containment: '.form_field_catcher',
    scroll: false,

    grid: [30, 30],
    snap: true,
    // snapMode: "outer",
    snapTolerance: 30
  });

  $('.form_field_catcher').droppable({
    accept: '.field_type',
    drop: function(event, ui){
      var fieldCatcherPosition = $(this).offset();
      var newlyDroppedButter = ui.draggable.clone()

      $(newlyDroppedButter).removeClass("field_type").addClass("added")
      $(this).append(newlyDroppedButter);

      //debugger

      $(newlyDroppedButter).css("top", Math.floor(ui.position.top / 10) * 10);
      $(newlyDroppedButter).css("left", Math.floor(ui.position.left / 10) * 10);

      $(newlyDroppedButter).draggable({ 
        // connectToSortable: newlyDroppedButter,
        containment: '.form_field_catcher',
        scroll: false,
        // obstacle: '.ui-draggable',
        // preventCollision: true,
        grid: [30, 30],
        snap: true,
        // snapMode: "outer",
        snapTolerance: 30
      });
// $(newlyDroppedButter).position({
//   my: 'left top',
//   at: 'right top',
//   of: otherElement,
//   collision: 'flipfit'
// });
    }
  })

  $('.added').dblclick(function(){
    console.log()
    $(this).remove();
  });

</script>

